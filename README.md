# Camera Watcher

This is a Python/Flask API wrapper to manage a repository of video clips to support video machine learning experiments. In this case the video is taken from a security camera.

Clips are generated by the [Motion Project](https://github.com/Motion-Project/motion) motion binary. (Initially a [Kerberos.io](https://kerberos.io/) docker image was used.) 

`motion` is a standalone binary running on a Raspberry Pi 4 which monitors the camera. When motion is detected, a video clip is generated, and a REST API call is made to this framework to record the event.

## Training data

The first task of this project is to collect training labels of the video clips. An [iPhone app](https://github.com/tomwhipple/camera-trainer) has been developed which uses this framework to store results.

## Dependencies

Python 3.9 is required. This is a pain for systems based on Debian Buster. The easiest workaround is to compile Python from source. 

The install depends upon relatively generic installs Lighttpd, MariaDB and Redis. 

Based on a fresh install May 5, 2022 of the arm64 image of RaspberryPi OS - Lite, the following should be run before anything else.

```
$ sudo apt install autoconf automake autopoint pkgconf libtool build-essential libzip-dev gettext libmicrohttpd-dev libjpeg62-turbo-dev libavformat-dev libavcodec-dev libavutil-dev libswscale-dev libavdevice-dev mariadb-server lighttpd redis ffmpeg python3-venv python3-opencv mariadb-client libmariadb-dev-compat python3-dev
```

After setting up a virtual environment, install python modules as

```
$ python3 -m pip install -r requirements.txt
```

### Motion

Motion 4.4 should likely be built from scratch. Install per project instructions with the following exception if warranted.

Raspbian doesn't seem to have 64-bit support for the raspi camera working yet.

`(src/motion)$ ./configure --without-mmal`